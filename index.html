<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>行銷搬進大程式</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="img/logo_icon.svg">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/main.scss" rel="stylesheet">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <!-- <script type="text/javascript" src="js/line-liff.js"></script> -->
</head>


<body>
  <!-- <div class="container mt-5">
    <div class="row justify-content-center align-items-center" style="text-align: center;">
      <div class="col-sm-12">
        <button onclick="share_BusinessCard()" type="button" class="btn back-major-ten text-white">選擇好友 or 群組</button>
      </div>
    </div>
  </div> -->
</body>

<script>
  liff.init({
    liffId: "1657826069-OmEnqNJY",
  }).then(function () {
    // 這邊開始寫使用其他功能
    if (liff.isLoggedIn()) { // 判斷是否有登入line
      let params = new URLSearchParams(location.search);
      let card = params.get('card')
      alert("即將開始")
      var xhr = new XMLHttpRequest()
      xhr.open('GET', "https://raw.githubusercontent.com/Ivan-Webpage/share_card/main/json/" + card + ".json", true)
      xhr.send()
      alert("請求完成")
      xhr.onload = function () {
        alert("第一步:"+this.responseText)
        var get = JSON.parse(this.responseText);
        alert("第二步:"+get["type"])
        liff.shareTargetPicker([
          get
        ]).catch((error) => {
          alert(("死掉了:"+error))
        })
      }
    } else {
      alert('請先登入Line！')
      liff.login({
        redirectUri: "https://ivan-webpage.github.io/share_card/" // 使用者登入後要去到哪個頁面
      });
    }
  }).catch(function (error) {
    console.log("掛掉了: " + error);
  });

  // 使用者分享
  function share_BusinessCard() {
    let params = new URLSearchParams(location.search);
    let card = params.get('card')
    
    var xhr = new XMLHttpRequest()
    xhr.open('GET', "https://raw.githubusercontent.com/Ivan-Webpage/share_card/main/json/" + card + ".json", true)
    xhr.send()
    xhr.onload = function () {
      alert("第一步:"+this.responseText)
      var get = JSON.parse(this.responseText);
      alert("第二步:"+get["type"])
      liff.shareTargetPicker([
        get
      ]).catch((error) => {
        alert(("死掉了:"+error))
      })
    }.catch((error) => {
      alert("執行失敗，您是否有登入Line且授權呢？")
    })
    

  }
</script>

</html>
